# 实施计划：Web Dashboard

## 概述

本实施计划将 Web Dashboard 设计分解为增量式的编码任务。每个任务都建立在前面的任务之上，确保在整个开发过程中功能可以逐步验证。任务专注于核心实现，测试任务标记为可选以加快 MVP 开发。

## 任务

- [ ] 1. 项目初始化和基础设施
  - 使用 Vite 创建 React + TypeScript 项目
  - 配置 Tailwind CSS 和 Ant Design
  - 设置项目目录结构（components、features、services、store、types、utils）
  - 配置 ESLint 和 Prettier
  - 创建基础类型定义文件（types/index.ts）
  - _需求：1.1_

- [ ]* 1.1 设置测试框架
  - 配置 Vitest 和 React Testing Library
  - 配置 fast-check 用于属性测试
  - 创建测试工具函数（renderWithProviders 等）
  - _需求：1.1_

- [ ] 2. API 客户端实现
  - [ ] 2.1 创建 Axios 实例和拦截器
    - 实现 ApiClient 类的基础结构
    - 添加请求拦截器（添加 JWT token）
    - 添加响应拦截器（处理错误、token 刷新）
    - _需求：8.1, 8.3_
  
  - [ ] 2.2 实现认证 API 方法
    - 实现 login、logout、refreshToken 方法
    - 定义 AuthResponse 和 LoginCredentials 类型
    - _需求：7.2, 8.1_
  
  - [ ] 2.3 实现服务器管理 API 方法
    - 实现 getServers、getServer、createServer、updateServer、deleteServer
    - 定义 ServerInstance 和 ServerFormData 类型
    - _需求：3.1, 3.2, 8.1_
  
  - [ ] 2.4 实现玩家管理 API 方法
    - 实现 getPlayers、getPlayer、kickPlayer、banPlayer
    - 定义 PlayerRecord 和 PlayerFilter 类型
    - _需求：4.1, 8.1_
  
  - [ ] 2.5 实现命令和指标 API 方法
    - 实现 executeCommand、getMetrics、getEvents
    - 定义相关类型
    - _需求：5.2, 8.1_
  
  - [ ]* 2.6 编写 API 客户端属性测试
    - **属性 1: API 客户端 CRUD 操作正确性**
    - **验证需求：1.5, 8.1**

- [ ] 3. WebSocket 客户端实现
  - [ ] 3.1 创建 WebSocket 客户端类
    - 实现连接、断开、消息处理方法
    - 实现事件订阅机制（on、off 方法）
    - 定义 WebSocketMessage 类型
    - _需求：8.2_
  
  - [ ] 3.2 实现自动重连机制
    - 实现指数退避重连策略
    - 添加最大重连次数限制
    - 添加连接状态管理
    - _需求：8.5_
  
  - [ ]* 3.3 编写 WebSocket 客户端属性测试
    - **属性 22: WebSocket 自动重连**
    - **验证需求：8.5**

- [ ] 4. Redux Store 配置
  - [ ] 4.1 创建 Redux store 和根 reducer
    - 配置 Redux Toolkit store
    - 创建 RootState 类型
    - 配置 Redux DevTools
    - _需求：9.2_
  
  - [ ] 4.2 实现 authSlice
    - 创建认证状态和 reducer
    - 实现 login、logout、setUser actions
    - 实现 selectUser、selectIsAuthenticated selectors
    - _需求：7.3, 7.5_
  
  - [ ] 4.3 实现 serversSlice
    - 创建服务器状态和 reducer
    - 实现 setServers、selectServer actions
    - 使用 RTK Query 定义服务器 API endpoints
    - _需求：3.1_
  
  - [ ] 4.4 实现 playersSlice
    - 创建玩家状态和 reducer
    - 实现 setPlayers、setFilters actions
    - 使用 RTK Query 定义玩家 API endpoints
    - _需求：4.1_
  
  - [ ] 4.5 实现 commandsSlice 和 eventsSlice
    - 创建命令历史状态
    - 创建事件日志状态
    - 实现相关 actions 和 selectors
    - _需求：5.4, 6.1_
  
  - [ ] 4.6 实现 metricsSlice 和 uiSlice
    - 创建指标数据状态
    - 创建 UI 状态（侧边栏、主题、通知）
    - 实现相关 actions 和 selectors
    - _需求：2.2, 9.1_
  
  - [ ]* 4.7 编写 Redux slice 单元测试
    - 测试所有 reducer 和 selector
    - _需求：9.2_

- [ ] 5. 自定义 Hooks 实现
  - [ ] 5.1 实现 useAuth hook
    - 封装认证状态和操作
    - 实现 login、logout 函数
    - _需求：7.1, 7.3_
  
  - [ ] 5.2 实现 useWebSocket hook
    - 初始化 WebSocket 连接
    - 提供 subscribe 方法
    - 管理连接状态
    - _需求：8.2_
  
  - [ ] 5.3 实现 useRealTimeMetrics hook
    - 订阅服务器指标更新
    - 返回实时指标数据
    - _需求：2.3_
  
  - [ ]* 5.4 编写自定义 hooks 单元测试
    - 使用 @testing-library/react-hooks 测试
    - _需求：7.1, 8.2, 2.3_

- [ ] 6. 布局组件实现
  - [ ] 6.1 创建 AppLayout 组件
    - 实现主布局结构（顶栏、侧边栏、内容区）
    - 使用 Ant Design Layout 组件
    - 实现响应式布局
    - _需求：1.2, 1.3_
  
  - [ ] 6.2 创建 Sidebar 组件
    - 实现侧边导航菜单
    - 根据用户角色显示菜单项
    - 实现折叠/展开功能
    - _需求：1.3, 7.4_
  
  - [ ] 6.3 创建 TopBar 组件
    - 显示用户信息
    - 实现通知图标和下拉菜单
    - 实现登出功能
    - _需求：1.3, 6.3_
  
  - [ ]* 6.4 编写布局组件单元测试
    - 测试组件渲染和交互
    - _需求：1.2, 1.3_

- [ ] 7. 认证功能实现
  - [ ] 7.1 创建 LoginForm 组件
    - 使用 React Hook Form 和 Zod 验证
    - 实现登录表单 UI
    - 处理登录成功和失败
    - _需求：7.1_
  
  - [ ] 7.2 创建 ProtectedRoute 组件
    - 检查用户认证状态
    - 检查用户权限
    - 未认证时重定向到登录页
    - _需求：7.1, 7.4, 7.5_
  
  - [ ]* 7.3 编写认证组件属性测试
    - **属性 18: 会话建立和权限**
    - **属性 19: 会话过期重定向**
    - **验证需求：7.3, 7.5**

- [ ] 8. 检查点 - 确保认证和基础设施正常工作
  - 确保所有测试通过，如有问题请询问用户。

- [ ] 9. 仪表板功能实现
  - [ ] 9.1 创建 DashboardOverview 组件
    - 实现仪表板主视图布局
    - 显示服务器状态概览
    - 显示玩家统计
    - _需求：2.1, 2.2_
  
  - [ ] 9.2 创建 ServerStatusCard 组件
    - 显示单个服务器状态
    - 显示实时指标（玩家数、TPS、CPU、内存）
    - 使用 useRealTimeMetrics hook
    - _需求：2.1, 2.3_
  
  - [ ] 9.3 创建 MetricsChart 组件
    - 使用 Recharts 实现图表
    - 支持折线图、柱状图、面积图
    - 实现时间范围选择器
    - _需求：2.1, 2.5_
  
  - [ ]* 9.4 编写仪表板组件属性测试
    - **属性 2: 玩家统计聚合正确性**
    - **属性 3: WebSocket 实时更新**
    - **属性 4: 时间范围过滤**
    - **验证需求：2.2, 2.3, 2.5**

- [ ] 10. 服务器管理功能实现
  - [ ] 10.1 创建 ServerList 组件
    - 显示服务器列表
    - 实现搜索和过滤
    - 实现编辑和删除操作
    - _需求：3.1_
  
  - [ ] 10.2 创建 ServerForm 组件
    - 实现服务器添加/编辑表单
    - 使用 React Hook Form 和 Zod 验证
    - 根据服务器类型显示不同字段
    - _需求：3.2, 3.3, 3.5_
  
  - [ ] 10.3 创建 ConnectorConfigForm 组件
    - 为每种服务器类型实现配置表单
    - 支持 Vanilla、Paper、Spigot、Bukkit、Fabric、Forge、NeoForge、PMMP、Nukkit、LLBDS
    - 区分 Forge 和 NeoForge 配置
    - _需求：3.3, 10.1, 10.2, 10.3_
  
  - [ ] 10.4 实现服务器类型安装指南组件
    - 为每种服务器类型显示连接器安装指南
    - 提供配置示例
    - _需求：10.4_
  
  - [ ]* 10.5 编写服务器管理属性测试
    - **属性 5: 服务器类型特定配置显示**
    - **属性 6: 服务器配置验证**
    - **属性 27: 服务器连接器信息显示**
    - **验证需求：3.1, 3.3, 3.4, 3.5, 10.3, 10.4, 10.5**

- [ ] 11. 玩家管理功能实现
  - [ ] 11.1 创建 PlayerList 组件
    - 显示玩家列表
    - 实现搜索功能（用户名、UUID、服务器）
    - 实现排序功能
    - 实现分页
    - _需求：4.1, 4.2, 4.3_
  
  - [ ] 11.2 创建 PlayerDetail 组件
    - 显示玩家详细信息
    - 显示活动历史
    - 提供管理操作按钮（踢出、封禁、警告）
    - 根据用户角色显示操作
    - _需求：4.4, 4.5_
  
  - [ ]* 11.3 编写玩家管理属性测试
    - **属性 7: 多字段玩家搜索**
    - **属性 8: 玩家列表排序**
    - **属性 9: 玩家详情完整性**
    - **属性 10: 基于角色的操作可见性**
    - **验证需求：4.1, 4.2, 4.3, 4.4, 4.5, 7.4**

- [ ] 12. 命令执行功能实现
  - [ ] 12.1 创建 CommandConsole 组件
    - 实现命令输入框
    - 实现命令输出显示区域
    - 实现命令历史记录
    - 实现服务器选择器
    - _需求：5.1, 5.2, 5.3, 5.4_
  
  - [ ] 12.2 实现命令执行逻辑
    - 调用 API 执行命令
    - 处理命令结果
    - 更新命令历史
    - 处理错误
    - _需求：5.2, 5.5_
  
  - [ ]* 12.3 编写命令执行属性测试
    - **属性 11: 命令 API 调用正确性**
    - **属性 12: 命令输出显示**
    - **属性 13: 命令历史增长**
    - **属性 14: 命令错误处理**
    - **验证需求：5.2, 5.3, 5.4, 5.5**

- [ ] 13. 检查点 - 确保核心功能正常工作
  - 确保所有测试通过，如有问题请询问用户。

- [ ] 14. 事件日志和通知功能实现
  - [ ] 14.1 创建 EventLog 组件
    - 显示实时事件列表
    - 实现事件类型过滤
    - 实现严重级别过滤
    - 实现时间范围过滤
    - 显示事件详情
    - _需求：6.1, 6.2, 6.4, 6.5_
  
  - [ ] 14.2 创建 NotificationCenter 组件
    - 显示通知列表
    - 实现通知标记为已读
    - 实现全部清除功能
    - 实现通知点击跳转
    - _需求：6.3_
  
  - [ ] 14.3 实现事件 WebSocket 订阅
    - 订阅系统事件
    - 更新事件日志状态
    - 触发关键事件通知
    - _需求：6.1, 6.3_
  
  - [ ]* 14.4 编写事件日志属性测试
    - **属性 15: 事件分类和显示**
    - **属性 16: 关键事件通知触发**
    - **属性 17: 事件过滤**
    - **验证需求：6.1, 6.2, 6.3, 6.4, 6.5**

- [ ] 15. 错误处理和加载状态实现
  - [ ] 15.1 创建错误边界组件
    - 实现 React Error Boundary
    - 显示友好的错误页面
    - 提供重试和返回首页选项
    - _需求：8.3_
  
  - [ ] 15.2 实现全局错误处理
    - 在 API 拦截器中处理错误
    - 显示用户友好的错误消息
    - 处理不同类型的错误（4xx、5xx）
    - _需求：8.3_
  
  - [ ] 15.3 实现加载状态组件
    - 创建 LoadingSpinner 组件
    - 创建 Skeleton 加载占位符
    - 在 API 请求期间显示加载状态
    - _需求：8.4_
  
  - [ ]* 15.4 编写错误处理属性测试
    - **属性 20: API 错误处理**
    - **属性 21: 加载状态显示**
    - **验证需求：8.3, 8.4**

- [ ] 16. 状态持久化和缓存实现
  - [ ] 16.1 实现本地存储工具
    - 创建 localStorage 封装函数
    - 实现用户偏好持久化
    - 实现会话状态持久化
    - _需求：9.1, 9.4_
  
  - [ ] 16.2 配置 RTK Query 缓存
    - 配置缓存时间
    - 实现缓存失效策略
    - 实现乐观更新
    - _需求：9.3_
  
  - [ ] 16.3 实现离线检测
    - 监听网络状态变化
    - 显示离线提示
    - 恢复连接后自动刷新
    - _需求：9.5_
  
  - [ ]* 16.4 编写状态持久化属性测试
    - **属性 23: 用户偏好持久化往返**
    - **属性 24: 导航状态保持**
    - **属性 25: API 响应缓存**
    - **属性 26: 离线状态处理**
    - **验证需求：9.1, 9.2, 9.3, 9.4, 9.5**

- [ ] 17. 路由配置和页面组装
  - [ ] 17.1 配置 React Router
    - 定义所有路由
    - 配置受保护路由
    - 配置 404 页面
    - _需求：1.3_
  
  - [ ] 17.2 创建页面组件
    - LoginPage
    - DashboardPage
    - ServersPage
    - PlayersPage
    - CommandsPage
    - EventsPage
    - _需求：1.3_
  
  - [ ] 17.3 实现页面导航
    - 在 Sidebar 中添加导航链接
    - 实现面包屑导航
    - 实现页面标题更新
    - _需求：1.3_

- [ ] 18. 响应式设计优化
  - [ ] 18.1 实现移动端适配
    - 优化移动端布局
    - 实现触摸手势支持
    - 优化移动端表单
    - _需求：1.2, 1.4_
  
  - [ ] 18.2 实现主题切换
    - 实现亮色/暗色主题
    - 持久化主题选择
    - 在所有组件中应用主题
    - _需求：9.1_

- [ ] 19. 性能优化
  - [ ] 19.1 实现代码分割
    - 使用 React.lazy 和 Suspense
    - 按路由分割代码
    - 优化打包体积
    - _需求：9.3_
  
  - [ ] 19.2 实现虚拟滚动
    - 在长列表中使用虚拟滚动
    - 优化大数据集渲染性能
    - _需求：4.1, 6.5_
  
  - [ ] 19.3 实现防抖和节流
    - 在搜索输入中使用防抖
    - 在滚动事件中使用节流
    - _需求：4.1_

- [ ] 20. 最终检查点 - 完整功能测试
  - 确保所有功能正常工作
  - 确保所有测试通过
  - 如有问题请询问用户

- [ ]* 21. 集成测试和 E2E 测试
  - [ ]* 21.1 编写集成测试
    - 测试完整的用户流程
    - 测试组件间交互
    - 测试 API 集成
  
  - [ ]* 21.2 配置 Playwright
    - 安装和配置 Playwright
    - 创建测试工具函数
  
  - [ ]* 21.3 编写 E2E 测试
    - 测试登录流程
    - 测试服务器管理流程
    - 测试玩家管理流程
    - 测试命令执行流程

- [ ]* 22. 文档和部署准备
  - [ ]* 22.1 编写用户文档
    - 创建 README.md
    - 编写功能使用指南
    - 编写部署指南
  
  - [ ]* 22.2 配置生产构建
    - 优化生产构建配置
    - 配置环境变量
    - 创建 Docker 配置（可选）

## 注意事项

- 标记为 `*` 的任务是可选的，可以跳过以加快 MVP 开发
- 每个任务都引用了具体的需求以便追溯
- 检查点确保增量验证
- 属性测试验证通用正确性属性
- 单元测试验证具体示例和边缘情况